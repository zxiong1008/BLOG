@*@model IEnumerable<BLOG.Models.POST>*@
@model PagedList.PagedList<BLOG.Models.POST>


@{
    ViewBag.Title = "Check Out My Blog Posts!";
}

@*.IsAuthenticated allows user to use if registered & logged in, preferably for commenting
    .IsInRole allows the use if "Admin"
       types of secure: by role or by back-end
*@
<body>

    <div class="row">
        <div class="col-lg-12 text-center" style="vertical-align: middle;">
            <h1 class="section-heading"><i class="fa fa-comments"></i> @ViewBag.Title</h1>
        </div>
        <div class="col-sm-12">
            @if (User.IsInRole("Admin"))
            {
                <b>@Html.ActionLink("Create New", "Create")</b>
            }
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            @using (Html.BeginForm("Index", "POSTs", FormMethod.Post, htmlAttributes: new { @class = "form-inline topbar__search", role = "form" }))
            {
                <div class="row pull-right">
                    <div class="col-xs-12 ">
                        <label class="sr-only " for="nav-search">Search</label>
                        <input type="search" name="searchStr" class="form-control" id="nav-search" placeholder="Search Blog" />
                        <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                    </div>
                </div>
            }
        </div>
        @*@foreach (var item in Model)
            {
                <div class="row">
                    <div id=@("Blogtitle"+item.ID) class="col-sm-12">
                        @item.TITLE
                    </div>
                </div>
                <div class="row">
                    <div id=@("Blogtitle"+item.ID) class="col-sm-12">
                        @Html.Raw(item.BODY)
                    </div>
                </div>
            }*@
    </div>

    <div class="row center-block" style="max-width: 70%">
        @*@for (int i = 0; i < 8; i++)
            {

                <div class="col-sm-6" style="border: 2px solid green">
                    @i
                </div>

            }*@

        @foreach (var item in Model)
        {
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="padding: 20px; border: 5px hidden red">
                <div class="row" id="blog" style="padding: 10px;">
                    @************* PHOTO SECTION *************@
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="padding: 0 10%">
                        <a href="@Url.Action("Details", new { id = item.ID })" class="hvr-curl-top-right center-block" id="blog-border">
                            @if (item.MEDIA != null)
                            {
                                <img id="pic" src="@Url.Content(item.MEDIA)" alt="Image" width="100%" />
                            }
                            else
                            {
                                <div class="center-block">
                                    <img id="pic" src="https://media.giphy.com/media/10QeIV66dUxAgU/giphy.gif" alt="Image" width="100%" />
                                    <span style="background: white;">Sorry, there are no pictures attached to this post, but please enjoy this gif.</span>
                                </div>
                            }
                        </a>
                        <hr />
                    </div>

                    @************* INFO SECTION *************@
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" id="blog-border" style="padding: 20px;">
                        <div class="row">
                            <a id=@("blogtitle"+item.ID) href="@Url.Action("Details", new { id = item.ID })">
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 hvr-sweep-to-top">
                                    <h4>@item.TITLE</h4>
                                </div>
                            </a>
                        </div>
                        <hr />
                        <div class="row" id="blog-body">
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" @*style="background-color: rgba(34,34,34,0.2); border: 2px solid purple"*@>
                                <div id=@("blogtext"+item.ID) class="col-sm-12">
                                    <div id="wrapper + @item.ID">
                                        @Html.Raw(item.BODY)
                                    </div>
                                </div>
                                <a href=@("/Posts/Details/" + item.ID)><span class="hvr-icon-wobble-horizontal pull-right">Read more</span> </a>
                            </div>
                        </div>
                        <br />
                        <div class="row" id="blog-footer">
                            <div class="col-xs-12 col-sm-12 col-md-10 col-lg-10">
                                <i class="fa fa-calendar-o" aria-hidden="true"></i> CREATED: @item.CREATED.ToString("D")
                                <i class="fa fa-calendar-o" aria-hidden="true"></i> UPDATED: @item.UPDATED.Value.ToString("D")
                            </div>
                            <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2" style="text-align: right;">
                                @if (User.IsInRole("Admin"))
                                {
                                    <a href="@Url.Action("Edit", "POSTs", new { id = item.ID })" class="btn btn-default btn-xs" style="text-align: right"><i class="fa fa-edit"></i></a>
                                    using (Html.BeginForm("Delete", "POSTs", FormMethod.Post))
                                    {
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@item.ID" />
                                        <button type="submit" class="btn btn-default btn-sm">
                                            <i class="fa fa-close"></i>
                                        </button>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
    <div class="row">
        <div class="col-sm-12">
            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
            @Html.PagedListPager(Model, page => Url.Action("Index", new { page }))
        </div>
    </div>

    @*@Html.PagedListPager(Model, page => Url.Action("Index", new {  } ))*@

    @*pagelist.css line 53 & 54, to change page button color*@

    @section scripts{
        <script>
            var word = '@ViewBag.searchStr';
            if (word !== '') {
                var title = $("[id^=blogtitle]").html();
                $("[id^=blogtitle]").html(strReplaceAll(title, word, "<span class='highlight'>" + word + "</span>"));

                var text = $("[id^=blogtext]").html();
                $("[id^=blogtext]").html(strReplaceAll(text, word, "<span class='highlight'>" + word + "</span>"));
            }

            function strReplaceAll(string, Find, Replace) {
                try {
                    return string.replace(new RegExp(Find, "gi"), Replace);
                }
                catch (ex) {
                    return string;
                }
            }
        </script>
    }
</body>